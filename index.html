<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Browser World</title>
    <style>
        canvas {
            background: #222;
            display: block;
            margin: 0 auto;
        }
        #nameInput {
            display: block;
            margin: 10px auto;
            text-align: center;
        }
    </style>
</head>
<body>
    <input id="nameInput" placeholder="Enter your name" />
    <canvas id="gameCanvas" width="600" height="400"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const nameInput = document.getElementById("nameInput");

        let players = {};
        let myName = "";
        let myColor = "#00ff00";

        const socket = new WebSocket("wss://webworld-production.up.railway.app/ws/" + Math.floor(Math.random() * 10000));

        socket.onopen = () => {
            console.log("Connected to WebSocket server");
        };

        socket.onmessage = (event) => {
            players = JSON.parse(event.data);
        };

        nameInput.addEventListener("change", () => {
            myName = nameInput.value.trim();
        });

        const keys = {};
        document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
        document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

        function gameLoop() {
            if (myName && socket.readyState === WebSocket.OPEN) {
                let dx = 0, dy = 0;
                if (keys["w"]) dy -= 1;
                if (keys["s"]) dy += 1;
                if (keys["a"]) dx -= 1;
                if (keys["d"]) dx += 1;

                socket.send(JSON.stringify({ name: myName, dx, dy }));
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let id in players) {
                const p = players[id];
                ctx.fillStyle = p.name === myName ? myColor : "#ff0000";
                ctx.fillRect(p.x, p.y, 20, 20);
                ctx.fillStyle = "#fff";
                ctx.fillText(p.name, p.x, p.y - 5);
            }

            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
